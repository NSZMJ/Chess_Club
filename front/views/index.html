<html>
  <head>
    {{> head}}
  </head>
  <body>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" aria-label="Toggle theme">
      <svg id="moon-icon" viewBox="0 0 24 24" fill="none">
        <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <svg id="sun-icon" viewBox="0 0 24 24" fill="none" style="display: none;">
        <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>

    <!-- Header Section -->
    <header>
      <div class="logo-container">
        <svg class="top-center-svg" viewBox="0 0 61 115" fill="none">
          <rect x="5.23047" y="20.7578" width="50.9905" height="7.17188" stroke="currentColor" stroke-width="5"/>
          <rect x="4.5" y="99.1447" width="50.9905" height="13.2578" stroke="currentColor" stroke-width="5"/>
          <rect x="5.23047" y="2.5" width="7.17185" height="14.475" stroke="currentColor" stroke-width="5"/>
          <rect x="49.049" y="2.5" width="7.17185" height="14.475" stroke="currentColor" stroke-width="5"/>
          <rect x="27.1396" y="2.5" width="7.17185" height="14.475" stroke="currentColor" stroke-width="5"/>
          <path d="M18.3104 93.2366L18.5879 71.8659L57.9907 55.2603V74.4651L18.3104 93.2366Z" stroke="currentColor" stroke-width="5"/>
          <path d="M18.0669 33.1075L18.3461 54.4782L57.9906 71.0838V51.8791L18.0669 33.1075Z" stroke="currentColor" stroke-width="5"/>
          <path d="M42.8975 93.2366L42.62 71.8659L3.21722 55.2603V74.4651L42.8975 93.2366Z" stroke="currentColor" stroke-width="5"/>
          <path d="M42.8975 33.1075L42.62 54.4782L3.21722 71.0838V51.8791L42.8975 33.1075Z" stroke="currentColor" stroke-width="5"/>
        </svg>
      </div>
      <h1>Chess Club</h1>
      <p>Play chess online with friends around the world</p>
    </header>

    <div class="container">
      <!-- Main Game Section -->
      <main class="game-code-section">
        
        <input 
          type="text" 
          id="codeInput" 
          class="game-input" 
          placeholder="Enter game code"
          maxlength="20"
          autocomplete="off"
        >
        <div class="game-btns">
          <button id="createGame" class="main-btn">Create Game</button>
          <button id="joinGame" class="secondary-btn">Join Game</button>
        </div>
        <div id="errorMessage" class="error-message"></div>
      </main>

      <!-- How to Play Section -->
      <section class="rules-section">
        <h2 class="rules-title">How to Play</h2>
        
        <div class="rules-grid">
          <div class="rule-card">
            <h3>Getting Started</h3>
            <p>Create a new game or join an existing one using a game code. Share the code with your friend to start playing together.</p>
          </div>

          <div class="rule-card">
            <h3>Making Moves</h3>
            <p>On desktop: Click and drag pieces to move them. On mobile: Tap a piece to select it, then tap the destination square.</p>
          </div>

          <div class="rule-card">
            <h3>Game Features</h3>
            <ul class="rule-list">
              <li>Real-time multiplayer gameplay</li>
              <li>Automatic move validation</li>
              <li>Game state tracking (check, checkmate, draw)</li>
              <li>Move history and PGN notation</li>
            </ul>
          </div>

          <div class="rule-card">
            <h3>Tips</h3>
            <ul class="rule-list">
              <li>Make sure your friend has the correct game code</li>
              <li>Stay connected to avoid disconnection</li>
              <li>Use the theme toggle for your preferred view</li>
              <li>Games are saved until both players disconnect</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script src="/public/js/jquery-3.7.0.min.js"></script>
    <script>
      // Theme toggle logic
      const themeToggle = document.getElementById("theme-toggle");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const body = document.body;
      const moonIcon = document.getElementById("moon-icon");
      const sunIcon = document.getElementById("sun-icon");

      // Helper to set background SVG and toggle icon
      function setBackgroundSVG(light) {
        if (light) {
          body.classList.add("light-mode");
          body.classList.remove("dark-mode");
          sunIcon.style.display = "";
          moonIcon.style.display = "none";
        } else {
          body.classList.remove("light-mode");
          body.classList.add("dark-mode");
          sunIcon.style.display = "none";
          moonIcon.style.display = "";
        }
      }

      // On load, set theme from localStorage or system preference
      (function () {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "light") {
          setBackgroundSVG(true);
        } else if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          setBackgroundSVG(false);
        } else {
          setBackgroundSVG(false);
        }
      })();

      themeToggle.addEventListener("click", () => {
        const isLight = body.classList.contains("light-mode");
        setBackgroundSVG(!isLight);
        localStorage.setItem("theme", !isLight ? "light" : "dark");
      });

      // Game creation and joining logic
      $("#createGame").on("click", function () {
        window.location.replace("/white?code=" + $("#codeInput").val());
      });
      
      $("#joinGame").on("click", function () {
        window.location.replace("/black?code=" + $("#codeInput").val());
      });

      var urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("error") == "invalidCode") {
        $("#errorMessage").text("Invalid invite code");
      }
    </script>
  </body>
</html>
